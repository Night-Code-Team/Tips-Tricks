**Связанные заметки:** [[GitHub]] [[GIT config]]

Git - набор консольных утилит для работы с системой управления версий файлов и проектов.

Для начала настройки gitа нам необходимо его настроить [[GIT config]]

# Наименования


- Репозиторий - виртуальное хранилище проекта, сохраняющие версии проекта для доступа по мере необходимости
- Индексация - показывает изменения, сделанные в рабочем каталоге
- Коммит / Commit - элементы временной шкалы проекта git. Фактические снимки проекта с указанием изменений от предыдущего коммита.
- Ветка / Branch - указатель снимка изменений. Помогает разделить разработку проекта на отдельные составляющие. 

# Команды

## Создание репозитория
- `git init` - инициализировать репозиторий
	Опционально использовать:
	- `git init [project_name]` - инициализировать репозиторий с названием и созданием директории
- `git clone [link]` - использовать удаленный репозиторий где `link` - ссылка на репозиторий, который нужно скопировать

## Изменения
- `git add [file]` - индексировать файл, готовый к коммиту
	Опционально использовать `.` или `*` чтобы применить ко всем файлам.
- `git commit` - сделать коммит. Обязательно должны быть индексации.
	Опции:
	- `-m [text_text]` - комментарий
- `git reset [file]` - возврат к определенному коммиту, откат изменений

## Отслеживание репозитория
- `git status` - статус репозитория, какие были изменения, какие изменения индексированны
- `git diff` - показать изменения, не внесенные в индекс
	- `-cached` - изменения, внесенные в индекс
	- `git diff commit1 commit2` - изменения между коммитами
- `git blame [commit/file]` -  показать дату изменения для определенного коммита или файла
- `git log` - показать полную историю измений
	- `-p [file/dir]` - показать историю изменений для файла или папки

## Ветки
- `git branch` - все локальные ветки
	- `-av`  - показать все локальные и удаленные ветки
	- `git branch new_name` - создание новой ветки с названием
	- `-d branch name` - удалить ветку с названием
- `git checkout branch_name`  - переключиться к ветке по названию
- `git merge branch_name`  - объединить текущую ветку с другой по названию
- `git tag tag_name` - добавить тек к коммиту

## Удаленный сервер
- `git remote` - общая команда отвечающая за работу с удаленным сервером
- `git remote add [link]`  - добавить к локальному репозиторию ссылку на удаленный, это не нужно делать, если репозиторий скопировать `git clone` 

## Синхронизация
- `git fetch` - получить все изменения с удаленного сервера
- `git pull` - получить последние изменения с удаленного сервера
	- `--rebase` - получить изменения с удаленного сервера и перебазировать голову репозитория
- `git push` - отправить локальные изменения на удаленный сервер. Всегда стоит указывать куда отправлять и какую ветку

## Другое
- `git help` - справка

# Игнорирование файлов
Git-репозиторий изначально командой `git add *` индексирует все изменения всех файлов и папок, однако могут быть файлы, что нам не нужны или не представляют секретную информацию. Для этого существует файл `.gitignore` его необходимо создать. Он представляет собой простой файл со списком того что нужно игнорировать, так же внутри него работают регулярные выражения.

```txt
__pycache__
venv
bin
test.txt
test*
*.txt
```

Например для игнорирования всех файлов `.txt` стоит добавить в файл `*.txt` или если у нас много файлов с особыми символами `test123.txt`, можно настроить например `test***.txt`

Так же индексировать файлы, которые определенны в `.gitignore`, можно, но придется вручную вводить их названия `git add test.txt venv`

# Конфликты

## merge-конфликты

Если вы не одни работаете с гитом, то скорее всего вы скоро столкнетесь с проблемой, когда на сервере и на вашем файле есть изменения 1 файла и даже в 1 строке, но эти изменения разные и при их объединении возникнут ошибки. Git об этом вам сообщит при скачивании или отправки данных на сервер:

```zsh
КОНФЛИКТ (содержимое): Конфликт слияния в Obsidian/MAIN/.obsidian/workspace.json
error: не удалось применить коммит f958499... 1
подсказка: Resolve all conflicts manually, mark them as resolved with
подсказка: "git add/rm <conflicted_files>", then run "git rebase --continue".
подсказка: You can instead skip this commit: run "git rebase --skip".
подсказка: To abort and get back to the state before "git rebase", run "git rebase --abort".
Не удалось применить коммит f958499... 1

```

(Я на двух компах работал над заметками в обсидиане и файл workspace.json был изменен в обоих коммитах в 1 и том же месте)

Для решения обычно спасает команда `rebase` или её применение вместе с `pull` или `push`:

```zsh
git pull -r
git push -r origin master
```

Однако, не для этой ситуации. Тут нам необходимо зайти в инструмент, способный указать на проблему, например **Visual Studio Code**, там в специальном гит-меню пройтись по конфликтам и указать какой использовать.

НО! Её может не быть рядом, тогда нужно будет или удалить изменения из локального файла или изменения из серверного файла:

```zsh
git rm way/to/conflict/file
git add *
git commit ...
git pull -r
# Если будет указана проблема "удаленная HEAD", то просто:
git push where which_branch

# Другой вариант
git restore --staged way/to/conflict/file
git pull -r
```

Последний вариант может не помочь, т. к. изменения могут быть далеко за 1 изменения.
